---
import LanguageSwitcher from "./LanguageSwitcher.astro";

const currentPath = Astro.url.pathname;
const isJa = currentPath.startsWith('/ja') || (!currentPath.startsWith('/en') && currentPath !== '/');
const langPrefix = isJa ? '/ja' : '/en';

const nav = isJa ? [
  { href: `${langPrefix}/`, label: "ホーム" },
  { href: `${langPrefix}/products/`, label: "製品" },
  { href: `${langPrefix}/solutions/`, label: "ソリューション" },
  { href: `${langPrefix}/docs/`, label: "ドキュメント" },
  { href: `${langPrefix}/pricing/`, label: "価格" },
  { href: `${langPrefix}/ai/`, label: "AI Copilot (β)" },
  { href: `${langPrefix}/contact`, label: "お問い合わせ" },
] : [
  { href: `${langPrefix}/`, label: "Home" },
  { href: `${langPrefix}/products/`, label: "Products" },
  { href: `${langPrefix}/solutions/`, label: "Solutions" },
  { href: `${langPrefix}/docs/`, label: "Docs" },
  { href: `${langPrefix}/pricing/`, label: "Pricing" },
  { href: `${langPrefix}/ai/`, label: "AI Copilot (β)" },
  { href: `${langPrefix}/contact`, label: "Contact" },
];

const logoLabel = isJa ? "ruuley ホーム" : "ruuley Home";
const menuLabel = isJa ? "メニューを開く" : "Open menu";
const navLabel = isJa ? "メインナビゲーション" : "Main navigation";
---
<header class="site-header">
  <div class="container">
    <a class="logo" href={langPrefix + "/"} aria-label={logoLabel}>ruuley</a>
    <button class="menu-toggle" aria-label={menuLabel} aria-expanded="false" id="menu-toggle">
      <span id="menu-icon">☰</span>
    </button>
    <nav id="main-nav" aria-label={navLabel}>
      <ul>
        {nav.map((n) => (
          <li><a href={n.href}>{n.label}</a></li>
        ))}
        <li><LanguageSwitcher /></li>
      </ul>
    </nav>
  </div>
</header>
<script>
  (function() {
    const toggle = document.getElementById('menu-toggle');
    const nav = document.getElementById('main-nav');
    const icon = document.getElementById('menu-icon');
    if (toggle && nav) {
      toggle.addEventListener('click', () => {
        const isOpen = nav.classList.toggle('open');
        toggle.setAttribute('aria-expanded', isOpen);
        icon.textContent = isOpen ? '✕' : '☰';
      });
      // リンククリック時にメニューを閉じる
      nav.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          nav.classList.remove('open');
          toggle.setAttribute('aria-expanded', 'false');
          icon.textContent = '☰';
        });
      });
      // ESCキーでメニューを閉じる
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && nav.classList.contains('open')) {
          nav.classList.remove('open');
          toggle.setAttribute('aria-expanded', 'false');
          icon.textContent = '☰';
          toggle.focus();
        }
      });
    }
  })();
</script>
